---
title: "Post #1: Maddison Graph"
date: "2023-06-19"
image: "image.jpg"
execute:
  message: false
  warning: false
---


```{r}

library(tidyverse)
library(countrycode) 
library(RColorBrewer)
library(ggrepel)

# Data ####
owid_maddison_proj <- readr::read_csv("https://raw.githubusercontent.com/owid/owid-datasets/master/datasets/Maddison%20Project%20Database%202020%20(Bolt%20and%20van%20Zanden%20(2020))/Maddison%20Project%20Database%202020%20(Bolt%20and%20van%20Zanden%20(2020)).csv")

owid_maddison_proj_df <- owid_maddison_proj |>
  rename(country=1,year=2,gdppc=3,pop=4,gdp=5) |>
  mutate(iso3c = countrycode::countrycode(sourcevar = country, origin = "country.name", destination = "iso3c"),
                region = countrycode::countrycode(sourcevar = country, origin = "country.name", destination = "region"))

# A first visual ####
maddison_proj_1 <- owid_maddison_proj_df |>
  filter(year==1990) |>
  ggplot(aes(x=region,y=gdppc))+
  geom_boxplot()

# Display graph 
maddison_proj_1
```





```{r}

# Data ####
owid_maddison_proj_df2 <- owid_maddison_proj_df |>
  mutate(continent = countrycode::countrycode(sourcevar = iso3c, origin = "iso3c", destination = "continent"))

# New attempt ####
maddison_proj_2 <- owid_maddison_proj_df2 |>
  filter(year==1990, !is.na(continent)) |>
  group_by(continent) |>
  mutate(m_gdppc = median(gdppc, na.rm=TRUE)) |>
  ungroup() |>
  mutate(continent = fct_reorder(continent, m_gdppc)) |>
  ggplot(aes(x=continent,y=gdppc))+
  geom_boxplot()+
  scale_y_log10()+
  theme_classic()+
  theme(legend.position = "none")

# See the result ####
maddison_proj_2

```


```{r}

# A third visual ####
maddison_proj_3 <- owid_maddison_proj_df2 |>
  filter(year==1990, !is.na(continent)) |> 
  group_by(continent) |>
  mutate(m_gdppc = median(gdppc, na.rm=TRUE)) |>
  ungroup() |>
  mutate(continent = fct_reorder(continent, m_gdppc)) |>
  ggplot(aes(x=continent,y=gdppc, color=continent))+
  geom_boxplot(outlier.alpha= 0.5)+
  scale_y_log10()+
  coord_flip()+
  theme_classic()+
  theme(legend.position = "none")

maddison_proj_3
```



```{r}

# A forth visual ####
maddison_proj_4 <- owid_maddison_proj_df2 |>
  filter(year==1990, !is.na(continent)) |>
  group_by(continent) |>
  mutate(m_gdppc = median(gdppc, na.rm=TRUE)) |>
  ungroup() |>
  mutate(continent = fct_reorder(continent, m_gdppc)) |>
  ggplot(aes(x=continent,y=gdppc, color=continent))+
  geom_boxplot(outlier.alpha= 0.5)+
  geom_jitter(aes(shape=continent), alpha=0.4)+
  scale_color_brewer(palette="Set1")+
  scale_y_log10()+
  coord_flip()+
  theme_classic()+
  theme(legend.position = "none")

maddison_proj_4
```


```{r}

# A fifth visual ####
maddison_proj_5 <- owid_maddison_proj_df2 |>
  dplyr::filter(year==1990, !is.na(continent)) |>
  dplyr::group_by(continent) |>
  dplyr::mutate(m_gdppc = median(gdppc, na.rm=TRUE)) |>
  dplyr::ungroup() |>
  dplyr::mutate(continent = fct_reorder(continent, m_gdppc)) |>
  ggplot(aes(x=continent,y=gdppc, color=continent))+
  geom_boxplot(outlier.alpha= 0.5)+
  geom_jitter(aes(shape=continent), alpha=0.4)+
  geom_text_repel(data = . %>%
                    dplyr::filter(country %in%  c("Mexico","China","Nigeria","France","Australia"), year==1990),
                    aes(label=country), size=3, color="black",
                    position = position_jitter(seed = 1))+
  scale_y_continuous(trans = "log10",labels = scales::number_format(big.mark=" "))+
  scale_color_brewer(palette="Set1")+
  coord_flip()+
  labs(x = NULL, y = "GDP per capita",
       title = "Maddison Project - GDP per capita in 1990",
       subtitle = "GDP per capita",
       caption = "Source: Own calculations based on Maddison Project and OWID GitHub")+
  theme_classic()+
  theme(legend.position = "none",
        axis.text.y = element_text(size = 14)
  )

# Display plot ####
maddison_proj_5


```

